# Сервис для работы с кадастровыми запросами

Этот проект предоставляет RESTful API для работы с кадастровыми запросами. Сервис позволяет создавать новые запросы, получать историю запросов, а также просматривать запросы по кадастровому номеру. В дополнение, доступен базовый эндпоинт для проверки соединения с сервером.

## Основные возможности

- **Создание кадастрового запроса**: Создание нового кадастрового запроса и эмуляция ответа от внешнего сервера.
- **Получение истории запросов**: Получение полной истории кадастровых запросов.
- **Поиск по кадастровому номеру**: Получение истории запросов по заданному кадастровому номеру.
- **Проверка соединения**: Эндпоинт для проверки доступности сервера.

## Модель данных

### CadastralQuery
- `cadastral_number` (CharField): Кадастровый номер, связанный с запросом.
- `latitude` (FloatField): Широта, связанная с кадастровым объектом.
- `longitude` (FloatField): Долгота, связанная с кадастровым объектом.
- `response` (BooleanField): Ответ от внешнего сервера, который может быть `True` или `False`.

## API Эндпоинты

### POST `/query/`
Создание нового кадастрового запроса.

**Запрос:**
```json
{
    "cadastral_number": "1234567",
    "latitude": 10.0,
    "longitude": 20.0
}
```
**Ответ:**
```json
{
    "response": true
}
```

### GET `/history/`
Получение всей истории кадастровых запросов.

**Ответ:**
```json
[
    {
        "cadastral_number": "1234567",
        "latitude": 10.0,
        "longitude": 20.0,
        "response": true
    },
    ...
]
```

### GET `/history_by_cadastral/`
Получение истории запросов по заданному кадастровому номеру.

**Параметры:**

- `cadastral_number` (обязательный): Кадастровый номер для поиска.

**Ответы:**

- **200 OK:** Если кадастровый номер найден.
- **404 Not Found:** Если кадастровый номер не существует.
- **400 Bad Request:** Если кадастровый номер не указан.

### GET `/ping/`
Эндпоинт для проверки соединения с внешним сервером.

**Ответ:**

```json
{
    "message": "pong"
}
```

## Тестирование
В проекте предусмотрены тесты для всех API эндпоинтов. Тесты проверяют правильность работы сервиса в различных сценариях.

Для запуска тестов используйте команду:

```python manage.py test```

### Покрытие тестов
Проект также включает инструмент для проверки покрытия кода тестами с использованием coverage.

Чтобы запустить тесты с измерением покрытия, выполните следующие команды:

```coverage run --source='.' manage.py test```

После завершения тестов вы можете увидеть отчет о покрытии, выполнив команду:

```coverage report```

## Настройка Docker
Проект включает в себя файлы Dockerfile и docker-compose.yml для контейнеризации.

### Сборка Docker-образов
Для сборки Docker-образов выполните команду:

```docker-compose build```

### Запуск контейнеров
Для запуска контейнеров выполните команду:

```docker-compose up```

Сервис будет доступен по адресу http://localhost:8000/.

## Переменные окружения
Проект использует файл .env для управления настройками, специфичными для окружения.

**Пример файла .env:**
```dotenv
POSTGRES_ENGINE=django.db.backends.postgresql
POSTGRES_NAME=myapp
POSTGRES_USER=postgres
POSTGRES_PASSWORD=strong
POSTGRES_HOST=127.0.0.1
POSTGRES_PORT=5432
```

В проекте также представлен файл .env.sample в качестве примера.

## Требования
Все зависимости перечислены в файле requirements.txt. Для их установки выполните команду:

```python
pip install -r requirements.txt
```

## Админка
В Django-админке можно управлять кадастровыми запросами. Она доступна по адресу http://localhost:8000/admin/ (при работающем сервере).
